// Generated by CoffeeScript 1.6.3
(function() {
  (function($) {
    var Wysihtml5SizeMatters;
    Wysihtml5SizeMatters = (function() {
      function Wysihtml5SizeMatters(iframe, options) {
        this.$iframe = $(iframe);
        this.$body = this.findBody();
        this.addBodyStyles();
        this.adjustHeight();
        if (options && options.useTimer) {
          this.startInterval();
        } else {
          this.setupEvents();
        }
      }

      Wysihtml5SizeMatters.prototype.addBodyStyles = function() {
        this.$body.css('overflow', 'hidden');
        this.$body.css('min-height', 0);
        return this.$body.css('height', 'auto');
      };

      Wysihtml5SizeMatters.prototype.setupEvents = function() {
        var _this = this;
        return this.$body.on('keyup keydown paste change focus', function() {
          return _this.adjustHeight();
        });
      };

      Wysihtml5SizeMatters.prototype.adjustHeight = function() {
        return this.$iframe.css('min-height', this.$body.height() + this.extraBottomSpacing());
      };

      Wysihtml5SizeMatters.prototype.extraBottomSpacing = function() {
        return parseInt(this.$body.css('line-height')) || this.estimateLineHeight();
      };

      Wysihtml5SizeMatters.prototype.estimateLineHeight = function() {
        return parseInt(this.$body.css('font-size')) * 1.14;
      };

      Wysihtml5SizeMatters.prototype.findBody = function() {
        return this.$iframe.contents().find('body');
      };

      Wysihtml5SizeMatters.prototype.startInterval = function() {
        var _this;
        _this = this;
        _this.intervalId = setInterval((function() {
          return _this.adjustHeight();
        }), 250);
        return _this.intervalId;
      };

      Wysihtml5SizeMatters.prototype.stopInterval = function() {
        if (this.intervalId) {
          return clearInterval(this.intervalId);
        }
      };

      return Wysihtml5SizeMatters;

    })();
    return $.fn.wysihtml5_size_matters = function(command, options) {
      if (command && !options) {
        options = command;
      }
      if (command === "stopTimer") {
        return this.each(function() {
          var wysihtml5_size_matters;
          wysihtml5_size_matters = $.data(this, 'wysihtml5_size_matters');
          if (wysihtml5_size_matters) {
            return wysihtml5_size_matters.stopInterval;
          }
        });
      } else {
        return this.each(function() {
          var wysihtml5_size_matters;
          wysihtml5_size_matters = $.data(this, 'wysihtml5_size_matters');
          if (!wysihtml5_size_matters) {
            return wysihtml5_size_matters = $.data(this, 'wysihtml5_size_matters', new Wysihtml5SizeMatters(this, options));
          }
        });
      }
    };
  })($);

}).call(this);
